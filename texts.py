from __future__ import annotations

from typing import List, Callable
import random
import html

E = {
    "ok": "‚úÖ",
    "no": "‚ùå",
    "warn": "‚ö†Ô∏è",
    "bell": "‚è∞",
    "spark": "‚ú®",
    "ping": "üèì",
    "list": "üìã",
    "repeat": "üîÅ",
    "pause": "‚è∏Ô∏è",
    "play": "‚ñ∂Ô∏è",
    "trash": "üóëÔ∏è",
    "clock": "üïí",
    "gear": "‚öôÔ∏è",
    "info": "‚ÑπÔ∏è",
    "trophy": "üèÜ",
    "rocket": "üöÄ",
}

def plural_ru(n: int, f1: str, f2: str, f5: str) -> str:
    n = abs(int(n))
    n10 = n % 10
    n100 = n % 100
    if n10 == 1 and n100 != 11:
        return f1
    if 2 <= n10 <= 4 and not (12 <= n100 <= 14):
        return f2
    return f5

TOURNAMENT_VARIANTS: List[str] = [
    f"{E['bell']} –ß–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç —Å—Ç–∞—Ä—Ç—É–µ—Ç {{title}} ‚Äî –Ω–∞—á–∞–ª–æ –≤ {{time}}!",
    f"üî• {{title}} –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –≤ {{time}}. –û—Å—Ç–∞–ª–æ—Å—å 5 –º–∏–Ω—É—Ç!",
    f"‚ö° {{title}} —á–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç ({{time}}). –ü–æ–µ—Ö–∞–ª–∏!",
    f"{E['rocket']} –ß–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç —Å—Ç–∞—Ä—Ç—É–µ—Ç {{title}}! –ù–∞—á–∞–ª–æ –≤ {{time}}, –Ω–µ –ø—Ä–æ–ø—É—Å—Ç–∏!",
    f"‚è≥ –û—Å—Ç–∞–ª–æ—Å—å 5 –º–∏–Ω—É—Ç ‚Äî {{title}} –Ω–∞ —Å—Ç–∞—Ä—Ç–µ! ({{time}})",
    f"üïì –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ: {{title}} –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –≤ {{time}}.",
]

REMINDER_VARIANTS: List[str] = [
    f"{E['bell']} –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ: {{title}}",
    f"{E['spark']} –ü–æ—Ä–∞: {{title}}",
    f"{E['info']} –ù–µ –∑–∞–±—É–¥—å: {{title}}",
    f"üéØ –°–∞–º–æ–µ –≤—Ä–µ–º—è: {{title}}",
]

REMINDER_TEMPLATES: List[str] = [
    f"{E['rocket']} –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –ø—Ä–∏–ª–µ—Ç–µ–ª–æ! ",
    f"{E['spark']} –í—Ä–µ–º—è –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å! ",
    f"–¢–∏–∫-—Ç–∞–∫! ",
    f"–ü–æ–µ—Ö–∞–ª–∏! ",
    f"–ë–µ—Ä—É –Ω–∞ –∫–æ–Ω—Ç—Ä–æ–ª—å: ",
]

def pick_phrase(variants: List[str], *, title: str, time: str | None = None) -> str:
    base = random.choice(variants)
    return base.format(title=html.escape(title), time=(time or ""))

def smart_phrase(prefix: str | None = None) -> str:
    base = random.choice(REMINDER_TEMPLATES)
    return (prefix or "") + base

MSG: dict[str, str | Callable[..., str]] = {
    "enter_text": f"{E['spark']} –í–≤–µ–¥–∏ —Ç–µ–∫—Å—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è:",
    "when_once": (
        f"{E['clock']} –ö–æ–≥–¥–∞ –Ω–∞–ø–æ–º–Ω–∏—Ç—å?\n"
        "–ü—Ä–∏–º–µ—Ä—ã: <b>14:30</b> ¬∑ <b>–∑–∞–≤—Ç—Ä–∞ 10:00</b> ¬∑ <b>—á–µ—Ä–µ–∑ 25</b> ¬∑ <b>+15</b>"
    ),
    "created_once": lambda txt, when_utc: (
        f"{E['ok']} –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ:\n<b>{html.escape(txt)}</b>\n"
        f"{E['clock']} {when_utc}"
    ),
    "enter_text_repeat": f"{E['spark']} –í–≤–µ–¥–∏ —Ç–µ–∫—Å—Ç <b>–ø–æ–≤—Ç–æ—Ä—è—é—â–µ–≥–æ—Å—è</b> –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è:",
    "when_repeat": (
        f"{E['clock']} –ö–∞–∫–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ?\n"
        "‚Ä¢ <b>–∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É</b>\n"
        "‚Ä¢ <b>–∫–∞–∂–¥—ã–µ N –º–∏–Ω—É—Ç</b>\n"
        "‚Ä¢ <b>–µ–∂–µ–¥–Ω–µ–≤–Ω–æ HH:MM</b>\n"
        "‚Ä¢ <b>HH:MM</b> (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ)\n"
        "‚Ä¢ <b>cron: * * * * *</b> (–ª—é–±–æ–π CRON)"
    ),
    "created_cron": lambda txt, cron, next_utc: (
        f"{E['ok']} –ü–æ–≤—Ç–æ—Ä—è—é—â–µ–µ—Å—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ:\n"
        f"<b>{html.escape(txt)}</b>\n"
        f"{E['repeat']} CRON: <code>{html.escape(cron)}</code>\n"
        f"{E['clock']} –ë–ª–∏–∂–∞–π—à–µ–µ: <b>{next_utc}</b>"
    ),
    "list_empty": f"{E['list']} –ü–æ–∫–∞ –Ω–µ—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π.",
    "list_header": f"<b>{E['list']} –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è —ç—Ç–æ–≥–æ —á–∞—Ç–∞:</b>",
    "paused": f"{E['pause']} –ü–æ—Å—Ç–∞–≤–ª–µ–Ω–æ –Ω–∞ –ø–∞—É–∑—É",
    "resumed": f"{E['play']} –í–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–æ",
    "deleted": f"{E['trash']} –£–¥–∞–ª–µ–Ω–æ",
    "pong_ok": f"{E['ping']} pong ‚Äî –±–∞–∑–∞ –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –≤ –ø–æ—Ä—è–¥–∫–µ",
    "pong_db_err": lambda err: f"{E['ping']} pong ‚Äî {E['no']} db error: <code>{html.escape(str(err))}</code>",
    "bad_action": f"{E['warn']} –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ.",
    "bad_data": f"{E['warn']} –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.",
    "create_fail": lambda err: f"{E['no']} –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å. –ü—Ä–∏—á–∏–Ω–∞: <code>{html.escape(str(err))}</code>",
    "create_cron_fail": (
        f"{E['no']} –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –ø–æ–≤—Ç–æ—Ä—è—é—â–µ–µ—Å—è. "
        "–ü—Ä–æ–≤–µ—Ä—å —Ñ–æ—Ä–º–∞—Ç (–º–æ–∂–Ω–æ <code>cron: EXPR</code>)."
    ),
}

HELP_TEXT = (
    f"{E['spark']} –ü—Ä–∏–≤–µ—Ç! –Ø –±–æ—Ç-–Ω–∞–ø–æ–º–∏–Ω–∞–ª–∫–∞ –¥–ª—è —Ç—É—Ä–Ω–∏—Ä–æ–≤ –∏ –ª—é–±—ã—Ö —Å–æ–±—ã—Ç–∏–π.\n\n"
    f"{E['trophy']} –¢—É—Ä–Ω–∏—Ä—ã:\n"
    "‚Ä¢ /subscribe_tournaments ‚Äî –≤–∫–ª—é—á–∏—Ç—å —Ç—É—Ä–Ω–∏—Ä–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –≤ —ç—Ç–æ–º —á–∞—Ç–µ\n"
    "‚Ä¢ /unsubscribe_tournaments ‚Äî –≤—ã–∫–ª—é—á–∏—Ç—å —Ç—É—Ä–Ω–∏—Ä–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è\n"
    "\n"
    f"{E['bell']} –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è:\n"
    "‚Ä¢ /add ‚Äî –º–∞—Å—Ç–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–æ–≥–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è\n"
    "  –ü—Ä–∏–º–µ—Ä—ã –≤—Ä–µ–º–µ–Ω–∏: 14:30 ‚Ä¢ –∑–∞–≤—Ç—Ä–∞ 10:00 ‚Ä¢ —á–µ—Ä–µ–∑ 25 ‚Ä¢ +15\n"
    "‚Ä¢ /add_repeat ‚Äî –º–∞—Å—Ç–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–≤—Ç–æ—Ä—è—é—â–µ–≥–æ—Å—è (–∫–∞–∂–¥—ã–µ N –º–∏–Ω—É—Ç / –µ–∂–µ–¥–Ω–µ–≤–Ω–æ / cron)\n"
    "‚Ä¢ /list ‚Äî —Å–ø–∏—Å–æ–∫ —Å –∫–Ω–æ–ø–∫–∞–º–∏ (–ø–∞—É–∑–∞/—É–¥–∞–ª–∏—Ç—å)\n"
    "\n"
    f"{E['info']} –ü–æ–ª–µ–∑–Ω–æ–µ:\n"
    "‚Ä¢ /ping ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ\n"
    "‚Ä¢ /help ‚Äî —ç—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞\n"
)
